{"version":3,"sources":["src/commands.js"],"names":["$","document","ready","window","FTW","cmd","exec","executeFunction","str","length","parts","split","command","splice","match","socket","emit","key","send","empty","chat","previousSender","name","ignoreList","has","delete","add","to","message","join","xhttp","XMLHttpRequest","onreadystatechange","readyState","status","response","JSON","parse","responseText","error","username","rating","wins","games","open","msg","safeAppend","from","type"],"mappings":";;AAAA;AACAA,EAAEC,QAAF,EAAYC,KAAZ,CAAkB,YAAM;AACtB,MAAIC,OAAOC,GAAP,IAAc,CAACD,OAAOC,GAAP,CAAWC,GAA9B,EAAmC;AACjC,QAAMA,MAAM,EAAZ;;AAEAA,QAAIC,IAAJ,GAAW,SAASC,eAAT,CAAyBC,GAAzB,EAA8B;AAAA;;AACvC,UAAIA,IAAIC,MAAJ,KAAe,CAAnB,EAAsB;AACpB;AACD;;AAED,UAAMC,QAAQF,IAAIG,KAAJ,CAAU,GAAV,CAAd;AACA,UAAMC,UAAUF,MAAMG,MAAN,CAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,CAAhB;;AAEA;AACA,UAAMC,QAAQN,IAAIM,KAAJ,CAAU,+BAAV,CAAd;;AAEA,UAAIA,KAAJ,EAAW;AACTX,eAAOC,GAAP,CAAWW,MAAX,CAAkBC,IAAlB,CACE,eADF,EAGE;AACEC,eAAKH,MAAM,CAAN,CADP;AAEEF,mBAAYE,MAAM,CAAN,CAAZ,SAAwBA,MAAM,CAAN;AAF1B,SAHF;;AASA;AACD;;AAED,cAAQF,OAAR;AACE,aAAK,MAAL;AACE,eAAKM,IAAL,CAAU,mBAAV;AACA,eAAKA,IAAL,CAAU,mBAAV;AACA,eAAKA,IAAL,CAAU,uCAAV;AACA,eAAKA,IAAL,CAAU,0BAAV;AACA,eAAKA,IAAL,CAAU,gCAAV;AACA;AACF,aAAK,IAAL;AACElB,YAAE,eAAF,EAAmBmB,KAAnB;AACAhB,iBAAOC,GAAP,CAAWgB,IAAX,CAAgBC,cAAhB,GAAiC,EAAjC;AACA;AACF,aAAK,QAAL;AACE,cAAIX,MAAMD,MAAN,GAAe,CAAnB,EAAsB;AACpB,gBAAMa,OAAOZ,MAAM,CAAN,CAAb;;AAEA,gBAAIP,OAAOC,GAAP,CAAWgB,IAAX,CAAgBG,UAAhB,CAA2BC,GAA3B,CAA+BF,IAA/B,CAAJ,EAA0C;AACxCnB,qBAAOC,GAAP,CAAWgB,IAAX,CAAgBG,UAAhB,CAA2BE,MAA3B,CAAkCH,IAAlC;AACA,mBAAKJ,IAAL,CAAaI,IAAb;AACD,aAHD,MAGO;AACLnB,qBAAOC,GAAP,CAAWgB,IAAX,CAAgBG,UAAhB,CAA2BG,GAA3B,CAA+BJ,IAA/B;AACA,mBAAKJ,IAAL,CAAaI,IAAb;AACD;AACF,WAVD,MAUO;AACL,iBAAKJ,IAAL,CAAU,oDAAV;AACD;;AAED;AACF,aAAK,GAAL;AACA,aAAK,KAAL;AACE,cAAIR,MAAMD,MAAN,IAAgB,CAApB,EAAuB;AACrB,gBAAMkB,KAAKjB,MAAMG,MAAN,CAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,CAAX;AACAV,mBAAOC,GAAP,CAAWW,MAAX,CAAkBC,IAAlB,CACE,SADF,EAGE;AACEW,oBADF;AAEEC,uBAASlB,MAAMmB,IAAN,CAAW,GAAX;AAFX,aAHF;AAQD,WAVD,MAUO;AACL,iBAAKX,IAAL,CAAU,8BAAV;AACD;;AAED;AACF,aAAK,OAAL;AACE,cAAIR,MAAMD,MAAN,IAAgB,CAApB,EAAuB;AACrB,gBAAMqB,QAAQ,IAAIC,cAAJ,EAAd;;AAEAD,kBAAME,kBAAN,GAA2B,YAAM;AAC/B,kBAAIF,MAAMG,UAAN,KAAqB,CAArB,IAA0BH,MAAMI,MAAN,KAAiB,GAA/C,EAAoD;AAClD,oBAAMC,WAAWC,KAAKC,KAAL,CAAW,MAAKC,YAAhB,CAAjB;;AAEA,oBAAIH,SAASI,KAAb,EAAoB;AAClB,wBAAKrB,IAAL,CAAUiB,SAASI,KAAnB;AACD,iBAFD,MAEO;AACL,wBAAKrB,IAAL,CAAaiB,SAASK,QAAtB,oBAA6CL,SAASM,MAAtD;AACA,wBAAKvB,IAAL,qBAA4BiB,SAASO,IAArC,qBAAyDP,SAASQ,KAAlE;AACD;AACF;AACF,aAXD;;AAaAb,kBAAMc,IAAN,CAAW,KAAX,cAA4BlC,MAAM,CAAN,CAA5B,EAAwC,IAAxC;AACAoB,kBAAMZ,IAAN;AACD,WAlBD,MAkBO;AACL,iBAAKA,IAAL,CAAU,2BAAV;AACD;AACD;AACF;AACE,eAAKA,IAAL,CAAU,qCAAV;AACA;AAtEJ;AAwED,KAhGD;;AAkGAb,QAAIa,IAAJ,GAAW,UAAC2B,GAAD,EAAS;AAClB1C,aAAOC,GAAP,CAAWgB,IAAX,CAAgB0B,UAAhB,CAA2B;AACzBC,cAAM,SADmB;AAEzBnB,iBAASiB,GAFgB;AAGzBG,cAAM;AAHmB,OAA3B;AAKD,KAND;;AAQA7C,WAAOC,GAAP,CAAWC,GAAX,GAAiBA,GAAjB;AACD;AACF,CAhHD","file":"commands.js","sourcesContent":["/* eslint-env browser, jquery */\r\n$(document).ready(() => {\r\n  if (window.FTW && !window.FTW.cmd) {\r\n    const cmd = {};\r\n\r\n    cmd.exec = function executeFunction(str) {\r\n      if (str.length === 0) {\r\n        return;\r\n      }\r\n\r\n      const parts = str.split(' ');\r\n      const command = parts.splice(0, 1)[0];\r\n\r\n      // Quick admin command testing\r\n      const match = str.match(/^([a-z]*?)\\[(.*?)\\] ([a-z]*)$/);\r\n\r\n      if (match) {\r\n        window.FTW.socket.emit(\r\n          'admin command',\r\n\r\n          {\r\n            key: match[2],\r\n            command: `${match[1]} ${match[3]}`,\r\n          },\r\n        );\r\n\r\n        return;\r\n      }\r\n\r\n      switch (command) {\r\n        case 'help':\r\n          this.send('/help : Get help!');\r\n          this.send('/cc : Clear chat!');\r\n          this.send('/ignore : Ignore / unignore somebody!');\r\n          this.send('/msg : Private messages!');\r\n          this.send('/stats : Get somebody\\'s stats');\r\n          break;\r\n        case 'cc':\r\n          $('#chat-display').empty();\r\n          window.FTW.chat.previousSender = '';\r\n          break;\r\n        case 'ignore':\r\n          if (parts.length > 0) {\r\n            const name = parts[0];\r\n\r\n            if (window.FTW.chat.ignoreList.has(name)) {\r\n              window.FTW.chat.ignoreList.delete(name);\r\n              this.send(`${name} is no longer ignored!`);\r\n            } else {\r\n              window.FTW.chat.ignoreList.add(name);\r\n              this.send(`${name} is now ignored!`);\r\n            }\r\n          } else {\r\n            this.send('Please specify somebody to ignore! /ignore [name] ');\r\n          }\r\n\r\n          break;\r\n        case 'w':\r\n        case 'msg':\r\n          if (parts.length >= 2) {\r\n            const to = parts.splice(0, 1)[0];\r\n            window.FTW.socket.emit(\r\n              'whisper',\r\n\r\n              {\r\n                to,\r\n                message: parts.join(' '),\r\n              },\r\n            );\r\n          } else {\r\n            this.send('Please use /msg [name] [msg]');\r\n          }\r\n\r\n          break;\r\n        case 'stats':\r\n          if (parts.length >= 1) {\r\n            const xhttp = new XMLHttpRequest();\r\n\r\n            xhttp.onreadystatechange = () => {\r\n              if (xhttp.readyState === 4 && xhttp.status === 200) {\r\n                const response = JSON.parse(this.responseText);\r\n\r\n                if (response.error) {\r\n                  this.send(response.error);\r\n                } else {\r\n                  this.send(`${response.username} has rating ${response.rating}`);\r\n                  this.send(`They also have ${response.wins} wins out of ${response.games} games played.`);\r\n                }\r\n              }\r\n            };\r\n\r\n            xhttp.open('GET', `/stats/${parts[0]}`, true);\r\n            xhttp.send();\r\n          } else {\r\n            this.send('Please specify a username');\r\n          }\r\n          break;\r\n        default:\r\n          this.send('Unknown command. Do /help for help.');\r\n          break;\r\n      }\r\n    };\r\n\r\n    cmd.send = (msg) => {\r\n      window.FTW.chat.safeAppend({\r\n        from: 'Ftw Bot',\r\n        message: msg,\r\n        type: 'system',\r\n      });\r\n    };\r\n\r\n    window.FTW.cmd = cmd;\r\n  }\r\n});\r\n"]}