{"version":3,"sources":["src/chat.js"],"names":["$","document","ready","formatDate","getPrettyDate","date","day","getHours","min","getMinutes","createMessage","str","message","createElement","addClass","innerHTML","createHeader","name","header","sender","text","time","appendChild","window","FTW","Error","chat","freeze","messageQueue","ignoreList","Set","previousSender","appendMessage","addMessageToChat","msg","push","user","from","type","has","isNewSender","gutter","pfp","attr","jdenticon","update","container","body","Date","append","freezeChat","length","safeAppend","shift","scrollDiff","prop","height","stop","keypress","e","which","val","trim","charAt","cmd","exec","substring","socket","emit"],"mappings":";;AAAA;AACA;AACAA,EAAEC,QAAF,EAAYC,KAAZ,CAAkB,YAAM;AACtB,MAAMC,aAAa,SAASC,aAAT,CAAuBC,IAAvB,EAA6B;AAC9C,QAAMC,MAAMD,KAAKE,QAAL,EAAZ;AACA,QAAIC,MAAMH,KAAKI,UAAL,EAAV;;AAEA,QAAID,MAAM,EAAV,EAAc;AACZA,kBAAUA,GAAV;AACD;;AAED,WAAUF,GAAV,SAAiBE,GAAjB;AACD,GATD;;AAWA,MAAME,gBAAgB,SAAhBA,aAAgB,CAACC,GAAD,EAAS;AAC7B,QAAMC,UAAUX,SAASY,aAAT,CAAuB,KAAvB,CAAhB;AACAb,MAAEY,OAAF,EAAWE,QAAX,CAAoB,cAApB;;AAEAF,YAAQG,SAAR,GAAoBJ,GAApB;;AAGA,WAAOC,OAAP;AACD,GARD;;AAUA,MAAMI,eAAe,SAAfA,YAAe,CAACC,IAAD,EAAOZ,IAAP,EAAgB;AACnC,QAAMa,SAASjB,SAASY,aAAT,CAAuB,KAAvB,CAAf;AACAb,MAAEkB,MAAF,EAAUJ,QAAV,CAAmB,aAAnB;;AAEA,QAAMK,SAASlB,SAASY,aAAT,CAAuB,MAAvB,CAAf;AACAb,MAAEmB,MAAF,EAAUL,QAAV,CAAmB,qBAAnB;AACAd,MAAEmB,MAAF,EAAUC,IAAV,CAAeH,IAAf;AACA,QAAMI,OAAOpB,SAASY,aAAT,CAAuB,MAAvB,CAAb;AACAb,MAAEqB,IAAF,EAAQP,QAAR,CAAiB,wBAAjB;AACAd,MAAEqB,IAAF,EAAQD,IAAR,CAAajB,WAAWE,IAAX,CAAb;;AAEAa,WAAOI,WAAP,CAAmBH,MAAnB;AACAD,WAAOI,WAAP,CAAmBD,IAAnB;AACA,WAAOH,MAAP;AACD,GAdD;;AAgBA,MAAI,CAACK,OAAOC,GAAZ,EAAiB;AACf,UAAM,IAAIC,KAAJ,CAAU,uBAAV,CAAN;AACD;;AAED,MAAI,CAACF,OAAOC,GAAP,CAAWE,IAAhB,EAAsB;AACpB,QAAMA,OAAO,EAAb;AACA;AACAA,SAAKC,MAAL,GAAc,KAAd;AACAD,SAAKE,YAAL,GAAoB,EAApB;;AAEAF,SAAKG,UAAL,GAAkB,IAAIC,GAAJ,EAAlB;;AAEAJ,SAAKK,cAAL,GAAsB,EAAtB;;AAEAL,SAAKM,aAAL,GAAqB,SAASC,gBAAT,CAA0BC,GAA1B,EAA+B;AAClD,UAAIR,KAAKC,MAAT,EAAiB;AACfD,aAAKE,YAAL,CAAkBO,IAAlB,CAAuBD,GAAvB;AACA;AACD;;AAED,UAAME,OAAOF,IAAIG,IAAjB;AACA,UAAM1B,MAAMuB,IAAItB,OAAhB;AAPkD,UAQ1C0B,IAR0C,GAQjCJ,GARiC,CAQ1CI,IAR0C;;;AAUlD,UAAI,KAAKT,UAAL,CAAgBU,GAAhB,CAAoBH,IAApB,CAAJ,EAA+B;AAC7B;AACD;;AAED,UAAMI,cAAcJ,SAASV,KAAKK,cAAlC;;AAEA,UAAMnB,UAAUX,SAASY,aAAT,CAAuB,KAAvB,CAAhB;AACAb,QAAEY,OAAF,EAAWE,QAAX,CAAoB,WAApB;;AAEA,UAAIwB,SAAS,SAAb,EAAwB;AACtBtC,UAAEY,OAAF,EAAWE,QAAX,CAAoB,SAApB;AACD;;AAGD,UAAM2B,SAASxC,SAASY,aAAT,CAAuB,MAAvB,CAAf;AACAb,QAAEyC,MAAF,EAAU3B,QAAV,CAAmB,qBAAnB;;AAEA,UAAI0B,WAAJ,EAAiB;AACf,YAAME,MAAMzC,SAASY,aAAT,CAAuB,QAAvB,CAAZ;AACAb,UAAE0C,GAAF,EAAO5B,QAAP,CAAgB,KAAhB;AACAd,UAAE0C,GAAF,EAAOC,IAAP,CAAY,sBAAZ,EAAoCP,IAApC;AACApC,UAAE0C,GAAF,EAAOC,IAAP,CAAY,OAAZ,EAAqB,IAArB;AACA3C,UAAE0C,GAAF,EAAOC,IAAP,CAAY,QAAZ,EAAsB,IAAtB;AACAC,kBAAUC,MAAV,CAAiBH,GAAjB;;AAEA,YAAMI,YAAY7C,SAASY,aAAT,CAAuB,KAAvB,CAAlB;AACAb,UAAE8C,SAAF,EAAahC,QAAb,CAAsB,iBAAtB;;AAGAgC,kBAAUxB,WAAV,CAAsBoB,GAAtB;AACAD,eAAOnB,WAAP,CAAmBwB,SAAnB;AACD;;AAEDlC,cAAQU,WAAR,CAAoBmB,MAApB;;AAEA,UAAMM,OAAO9C,SAASY,aAAT,CAAuB,MAAvB,CAAb;AACAb,QAAE+C,IAAF,EAAQjC,QAAR,CAAiB,mBAAjB;;AAEA,UAAI0B,WAAJ,EAAiB;AACfO,aAAKzB,WAAL,CAAiBN,aAAaoB,IAAb,EAAmB,IAAIY,IAAJ,EAAnB,CAAjB;AACD;;AAEDD,WAAKzB,WAAL,CAAiBZ,cAAcC,GAAd,CAAjB;;AAEAC,cAAQU,WAAR,CAAoByB,IAApB;;AAEA/C,QAAE,eAAF,EAAmBiD,MAAnB,CAA0BrC,OAA1B;;AAEAc,WAAKK,cAAL,GAAsBK,IAAtB;AACD,KA3DD;;AA6DAV,SAAKwB,UAAL,GAAkB,UAACvB,MAAD,EAAY;AAC5B,UAAIA,MAAJ,EAAY;AACVD,aAAKC,MAAL,GAAc,IAAd;AACD,OAFD,MAEO;AACLD,aAAKC,MAAL,GAAc,KAAd;;AAEA,eAAOD,KAAKE,YAAL,CAAkBuB,MAAlB,GAA2B,CAAlC,EAAqC;AACnCzB,eAAK0B,UAAL,CAAgB1B,KAAKE,YAAL,CAAkByB,KAAlB,EAAhB;AACD;AACF;AACF,KAVD;;AAYA3B,SAAK0B,UAAL,GAAkB,UAAClB,GAAD,EAAS;AACzB,UAAMoB,aAAatD,EAAE,eAAF,EAAmBuD,IAAnB,CAAwB,cAAxB,IAA0CvD,EAAE,eAAF,EAAmBuD,IAAnB,CAAwB,WAAxB,CAA1C,GAAiFvD,EAAE,eAAF,EAAmBwD,MAAnB,EAApG;;AAEAjC,aAAOC,GAAP,CAAWE,IAAX,CAAgBM,aAAhB,CAA8BE,GAA9B;;AAEAlC,QAAE,eAAF,EAAmByD,IAAnB,CAAwB,IAAxB,EAA8B,IAA9B;;AAEA,UAAIH,aAAa,EAAjB,EAAqB;AACnBtD,UAAE,eAAF,EAAmBuD,IAAnB,CAAwB,WAAxB,EAAqCvD,EAAE,eAAF,EAAmBuD,IAAnB,CAAwB,cAAxB,CAArC;AACD;AACF,KAVD;;AAYAvD,MAAE,WAAF,EAAe0D,QAAf,CAAwB,UAACC,CAAD,EAAO;AAC7B,UAAIA,EAAEC,KAAF,KAAY,EAAhB,EAAoB;AAClB,YAAIhD,UAAUZ,EAAE,WAAF,EAAe6D,GAAf,EAAd;AACAjD,kBAAUA,QAAQkD,IAAR,EAAV;;AAEA,YAAIlD,YAAY,EAAhB,EAAoB;AAClB,cAAIA,QAAQmD,MAAR,CAAe,CAAf,MAAsB,GAA1B,EAA+B;AAC7BxC,mBAAOC,GAAP,CAAWwC,GAAX,CAAeC,IAAf,CAAoBrD,QAAQsD,SAAR,CAAkB,CAAlB,CAApB;AACD,WAFD,MAEO;AACL3C,mBAAOC,GAAP,CAAW2C,MAAX,CAAkBC,IAAlB,CAAuB,gBAAvB,EAAyCxD,OAAzC;AACD;AACF;;AAEDZ,UAAE,WAAF,EAAe6D,GAAf,CAAmB,EAAnB;AACD;AACF,KAfD;;AAiBAtC,WAAOC,GAAP,CAAWE,IAAX,GAAkBA,IAAlB;AACD;AACF,CA5JD","file":"chat.js","sourcesContent":["/* eslint-env browser, jquery */\r\n/* globals jdenticon */\r\n$(document).ready(() => {\r\n  const formatDate = function getPrettyDate(date) {\r\n    const day = date.getHours();\r\n    let min = date.getMinutes();\r\n\r\n    if (min < 10) {\r\n      min = `0${min}`;\r\n    }\r\n\r\n    return `${day}:${min}`;\r\n  };\r\n\r\n  const createMessage = (str) => {\r\n    const message = document.createElement('div');\r\n    $(message).addClass('chat-message');\r\n\r\n    message.innerHTML = str;\r\n\r\n\r\n    return message;\r\n  };\r\n\r\n  const createHeader = (name, date) => {\r\n    const header = document.createElement('div');\r\n    $(header).addClass('chat-header');\r\n\r\n    const sender = document.createElement('span');\r\n    $(sender).addClass('chat-message-sender');\r\n    $(sender).text(name);\r\n    const time = document.createElement('span');\r\n    $(time).addClass('chat-message-timestamp');\r\n    $(time).text(formatDate(date));\r\n\r\n    header.appendChild(sender);\r\n    header.appendChild(time);\r\n    return header;\r\n  };\r\n\r\n  if (!window.FTW) {\r\n    throw new Error('FTW object not loaded');\r\n  }\r\n\r\n  if (!window.FTW.chat) {\r\n    const chat = {};\r\n    // Should freeze chat or not\r\n    chat.freeze = false;\r\n    chat.messageQueue = [];\r\n\r\n    chat.ignoreList = new Set();\r\n\r\n    chat.previousSender = '';\r\n\r\n    chat.appendMessage = function addMessageToChat(msg) {\r\n      if (chat.freeze) {\r\n        chat.messageQueue.push(msg);\r\n        return;\r\n      }\r\n\r\n      const user = msg.from;\r\n      const str = msg.message;\r\n      const { type } = msg;\r\n\r\n      if (this.ignoreList.has(user)) {\r\n        return;\r\n      }\r\n\r\n      const isNewSender = user !== chat.previousSender;\r\n\r\n      const message = document.createElement('div');\r\n      $(message).addClass('chat-item');\r\n\r\n      if (type === 'private') {\r\n        $(message).addClass('chat-pm');\r\n      }\r\n\r\n\r\n      const gutter = document.createElement('span');\r\n      $(gutter).addClass('chat-message-gutter');\r\n\r\n      if (isNewSender) {\r\n        const pfp = document.createElement('canvas');\r\n        $(pfp).addClass('pfp');\r\n        $(pfp).attr('data-jdenticon-value', user);\r\n        $(pfp).attr('width', '50');\r\n        $(pfp).attr('height', '50');\r\n        jdenticon.update(pfp);\r\n\r\n        const container = document.createElement('div');\r\n        $(container).addClass('image-container');\r\n\r\n\r\n        container.appendChild(pfp);\r\n        gutter.appendChild(container);\r\n      }\r\n\r\n      message.appendChild(gutter);\r\n\r\n      const body = document.createElement('span');\r\n      $(body).addClass('chat-message-body');\r\n\r\n      if (isNewSender) {\r\n        body.appendChild(createHeader(user, new Date()));\r\n      }\r\n\r\n      body.appendChild(createMessage(str));\r\n\r\n      message.appendChild(body);\r\n\r\n      $('#chat-display').append(message);\r\n\r\n      chat.previousSender = user;\r\n    };\r\n\r\n    chat.freezeChat = (freeze) => {\r\n      if (freeze) {\r\n        chat.freeze = true;\r\n      } else {\r\n        chat.freeze = false;\r\n\r\n        while (chat.messageQueue.length > 0) {\r\n          chat.safeAppend(chat.messageQueue.shift());\r\n        }\r\n      }\r\n    };\r\n\r\n    chat.safeAppend = (msg) => {\r\n      const scrollDiff = $('#chat-display').prop('scrollHeight') - $('#chat-display').prop('scrollTop') - $('#chat-display').height();\r\n\r\n      window.FTW.chat.appendMessage(msg);\r\n\r\n      $('#chat-display').stop(true, true);\r\n\r\n      if (scrollDiff < 10) {\r\n        $('#chat-display').prop('scrollTop', $('#chat-display').prop('scrollHeight'));\r\n      }\r\n    };\r\n\r\n    $('#chat-box').keypress((e) => {\r\n      if (e.which === 13) {\r\n        let message = $('#chat-box').val();\r\n        message = message.trim();\r\n\r\n        if (message !== '') {\r\n          if (message.charAt(0) === '/') {\r\n            window.FTW.cmd.exec(message.substring(1));\r\n          } else {\r\n            window.FTW.socket.emit('public message', message);\r\n          }\r\n        }\r\n\r\n        $('#chat-box').val('');\r\n      }\r\n    });\r\n\r\n    window.FTW.chat = chat;\r\n  }\r\n});\r\n"]}