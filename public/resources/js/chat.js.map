{"version":3,"sources":["src/chat.js"],"names":["$","document","ready","formatDate","getPrettyDate","date","day","getHours","min","getMinutes","createMessage","str","message","createElement","addClass","innerHTML","createHeader","name","header","sender","text","time","appendChild","window","FTW","Error","chat","ignoreList","Set","previousSender","appendMessage","addMessageToChat","msg","user","from","type","has","isNewSender","gutter","pfp","attr","jdenticon","update","container","body","Date","append","safeAppend","scrollDiff","prop","height","stop","tempInput","autocomplete","source","request","response","match","term","test","emojies","filter","emoji","startsWith","slice","map","label","value","position","my","at","collision","open","$labels","children","html","i","innerText","outerHTML","select","event","ui","val","replace","item","stopPropagation","preventDefault","focus","keypress","e","which","trim","charAt","cmd","exec","substring","socket","emit"],"mappings":"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","file":"chat.js","sourcesContent":["/* eslint-env browser, jquery */\r\n/* globals jdenticon, emojies */\r\n$(document).ready(() => {\r\n  const formatDate = function getPrettyDate(date) {\r\n    const day = date.getHours();\r\n    let min = date.getMinutes();\r\n\r\n    if (min < 10) {\r\n      min = `0${min}`;\r\n    }\r\n\r\n    return `${day}:${min}`;\r\n  };\r\n\r\n  const createMessage = (str) => {\r\n    const message = document.createElement('div');\r\n    $(message).addClass('chat-message');\r\n\r\n    message.innerHTML = str;\r\n\r\n    return message;\r\n  };\r\n\r\n  const createHeader = (name, date) => {\r\n    const header = document.createElement('div');\r\n    $(header).addClass('chat-header');\r\n\r\n    const sender = document.createElement('span');\r\n    $(sender).addClass('chat-message-sender');\r\n    $(sender).text(name);\r\n    const time = document.createElement('span');\r\n    $(time).addClass('chat-message-timestamp');\r\n    $(time).text(formatDate(date));\r\n\r\n    header.appendChild(sender);\r\n    header.appendChild(time);\r\n    return header;\r\n  };\r\n\r\n  if (!window.FTW) {\r\n    throw new Error('FTW object not loaded');\r\n  }\r\n\r\n  if (!window.FTW.chat) {\r\n    const chat = {};\r\n\r\n    chat.ignoreList = new Set();\r\n\r\n    chat.previousSender = '';\r\n\r\n    chat.appendMessage = function addMessageToChat(msg) {\r\n      const user = msg.from;\r\n      const str = msg.message;\r\n      const { type } = msg;\r\n\r\n      if (this.ignoreList.has(user)) {\r\n        return;\r\n      }\r\n\r\n      const isNewSender = user !== chat.previousSender;\r\n\r\n      const message = document.createElement('div');\r\n      $(message).addClass('chat-item');\r\n\r\n      if (type === 'private') {\r\n        $(message).addClass('chat-pm');\r\n      }\r\n\r\n\r\n      const gutter = document.createElement('span');\r\n      $(gutter).addClass('chat-message-gutter');\r\n\r\n      if (isNewSender) {\r\n        const pfp = document.createElement('canvas');\r\n        $(pfp).addClass('pfp');\r\n        $(pfp).attr('data-jdenticon-value', user);\r\n        $(pfp).attr('width', '50');\r\n        $(pfp).attr('height', '50');\r\n        jdenticon.update(pfp);\r\n\r\n        const container = document.createElement('div');\r\n        $(container).addClass('image-container');\r\n\r\n\r\n        container.appendChild(pfp);\r\n        gutter.appendChild(container);\r\n      }\r\n\r\n      message.appendChild(gutter);\r\n\r\n      const body = document.createElement('span');\r\n      $(body).addClass('chat-message-body');\r\n\r\n      if (isNewSender) {\r\n        body.appendChild(createHeader(user, new Date()));\r\n      }\r\n\r\n      body.appendChild(createMessage(str));\r\n\r\n      message.appendChild(body);\r\n\r\n      $('#chat-display').append(message);\r\n\r\n      chat.previousSender = user;\r\n    };\r\n\r\n    chat.safeAppend = (msg) => {\r\n      const scrollDiff = $('#chat-display').prop('scrollHeight')\r\n        - $('#chat-display').prop('scrollTop')\r\n        - $('#chat-display').height();\r\n\r\n      window.FTW.chat.appendMessage(msg);\r\n\r\n      $('#chat-display').stop(true, true);\r\n\r\n      if (scrollDiff < 10) {\r\n        $('#chat-display').prop('scrollTop', $('#chat-display').prop('scrollHeight'));\r\n      }\r\n    };\r\n\r\n    // Emoji auto-complete\r\n    let tempInput = '';\r\n\r\n    $('#chat-box').autocomplete({\r\n      source(request, response) {\r\n        const match = request.term.match(/:([a-z0-9+\\-_]*?)$/);\r\n\r\n        if (match && !/:([a-z0-9+\\-_]*?):$/.test(request.term)) {\r\n          response(emojies\r\n            .filter(emoji => emoji.startsWith(match[1]))\r\n            .slice(0, 5)\r\n            // eslint-disable-next-line arrow-body-style\r\n            .map((emoji) => {\r\n              return {\r\n                label: `:${emoji}:`,\r\n                value: emoji,\r\n              };\r\n            }));\r\n\r\n          tempInput = request.term;\r\n        } else {\r\n          response([]);\r\n        }\r\n      },\r\n\r\n      position: { my: 'left bottom', at: 'left top', collision: 'flip' },\r\n\r\n      open() {\r\n        const $labels = $('#chat-box').autocomplete('widget').children().children();\r\n\r\n        $labels.html((i, html) => {\r\n          const emoji = $labels[i].innerText.match(/^:(.*):$/)[1];\r\n\r\n          return `${$('<img />')\r\n            .addClass('emoji')\r\n            .attr('src', `/emoji/${emoji}.png`)\r\n            .attr('title', emoji)\r\n            .attr('alt', `:${emoji}:`)[0].outerHTML} ${html}`;\r\n        });\r\n      },\r\n\r\n      select(event, ui) {\r\n        $('#chat-box').val(tempInput.replace(/:([a-z0-9+\\-_]*?)$/, `:${ui.item.value}:`));\r\n\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n      },\r\n\r\n      focus(event, ui) {\r\n        $('#chat-box').val(tempInput.replace(/:([a-z0-9+\\-_]*?)$/, `:${ui.item.value}:`));\r\n\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n      },\r\n    });\r\n\r\n    /* textcomplete.register(\r\n      [\r\n        {\r\n          id: 'emoji',\r\n          match: /\\B:([-+\\w]*)$/,\r\n\r\n          search(term, callback) {\r\n            callback(emojies.filter(emoji => emoji.startsWith(term)));\r\n          },\r\n\r\n          template(value) {\r\n            return `<img class=\"emoji\" src=\"/emoji/${value}.png\" title=\"${value}\" alt=\":${value}:\" />`;\r\n          },\r\n\r\n          replace(value) {\r\n            return `:${value}:`;\r\n          },\r\n\r\n          index: 1,\r\n        },\r\n      ],\r\n\r\n      {\r\n        onKeydown(e, commands) {\r\n          if (e.ctrlKey && e.keyCode === 74) { // CTRL-J\r\n            return commands.KEY_ENTER;\r\n          }\r\n\r\n          return null;\r\n        },\r\n      },\r\n    ); */\r\n\r\n    $('#chat-box').keypress((e) => {\r\n      if (e.which === 13) {\r\n        let message = $('#chat-box').val();\r\n        message = message.trim();\r\n\r\n        if (message !== '') {\r\n          if (message.charAt(0) === '/') {\r\n            window.FTW.cmd.exec(message.substring(1));\r\n          } else {\r\n            window.FTW.socket.emit('public message', message);\r\n          }\r\n        }\r\n\r\n        $('#chat-box').val('');\r\n      }\r\n    });\r\n\r\n    window.FTW.chat = chat;\r\n  }\r\n});\r\n"]}